<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MT ROAST - Premium Ordering System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #fafafa; }
        .glass-nav { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(15px); border-bottom: 1px solid rgba(255,107,53,0.1); }
        .product-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .product-card:hover { transform: translateY(-5px); }
        .cart-drawer { transition: transform 0.5s cubic-bezier(0.32, 0.72, 0, 1); transform: translateY(100%); }
        .cart-drawer.active { transform: translateY(0); }
        .shop-closed { filter: grayscale(1); pointer-events: none; opacity: 0.7; }
        .badge-closed { background: #ef4444; color: white; padding: 4px 12px; rounded: 20px; font-size: 10px; font-weight: bold; }
    </style>
</head>
<body class="pb-20">

    <header class="sticky top-0 z-50 glass-nav p-4 flex justify-between items-center">
        <div>
            <h1 class="text-xl font-extrabold tracking-tight text-slate-800">MYIN THAR <span class="text-orange-500">ROAST</span></h1>
            <div id="shop-status-ui"></div>
        </div>
        <div onclick="toggleCart(true)" class="relative p-3 bg-orange-50 rounded-2xl text-orange-600 cursor-pointer active:scale-90 transition">
            <i class="fas fa-shopping-bag text-xl"></i>
            <span id="cart-count" class="absolute -top-1 -right-1 bg-orange-600 text-white text-[10px] w-5 h-5 flex items-center justify-center rounded-full font-bold shadow-lg shadow-orange-200">0</span>
        </div>
    </header>

    <div class="p-4">
        <div class="bg-gradient-to-r from-orange-500 to-red-500 rounded-[2rem] p-6 text-white shadow-xl shadow-orange-200 relative overflow-hidden">
            <div class="relative z-10">
                <p class="text-orange-100 text-sm font-medium">Daily Fresh Roast</p>
                <h2 class="text-2xl font-extrabold mt-1">မြိန်သာ ကြက်ကင်</h2>
                <p class="text-xs mt-2 opacity-90"><i class="fas fa-clock mr-1"></i> Opening: 5:00 PM - 9:00 PM</p>
            </div>
            <i class="fas fa-fire-alt absolute right-[-20px] bottom-[-20px] text-9xl opacity-20"></i>
        </div>
    </div>

    <div class="flex overflow-x-auto gap-3 px-4 py-2 no-scrollbar">
        <button class="px-6 py-2.5 bg-orange-600 text-white rounded-2xl text-sm font-bold shadow-md">All</button>
        <button class="px-6 py-2.5 bg-white border border-slate-100 text-slate-600 rounded-2xl text-sm font-bold">Chicken</button>
        <button class="px-6 py-2.5 bg-white border border-slate-100 text-slate-600 rounded-2xl text-sm font-bold">Sides</button>
    </div>

    <div id="menu-grid" class="grid grid-cols-2 gap-4 p-4">
        </div>

    <div id="cart-drawer" class="fixed inset-0 z-[60] bg-white cart-drawer flex flex-col rounded-t-[3rem] shadow-2xl">
        <div class="h-1.5 w-12 bg-slate-200 rounded-full mx-auto mt-4 mb-2" onclick="toggleCart(false)"></div>
        <div class="p-6 border-b flex justify-between items-center">
            <h2 class="text-xl font-extrabold">Your Order</h2>
            <button onclick="toggleCart(false)" class="text-slate-400"><i class="fas fa-times"></i></button>
        </div>
        
        <div id="cart-items" class="flex-1 overflow-y-auto p-6 space-y-6">
            </div>

        <div class="p-8 bg-slate-50 border-t rounded-t-[3rem] space-y-4 shadow-inner">
            <div class="grid grid-cols-2 gap-3">
                <input type="text" id="cust-name" placeholder="Name" class="p-4 bg-white rounded-2xl border-none ring-1 ring-slate-200 focus:ring-2 focus:ring-orange-500 outline-none text-sm font-medium">
                <input type="tel" id="cust-phone" placeholder="Phone" class="p-4 bg-white rounded-2xl border-none ring-1 ring-slate-200 focus:ring-2 focus:ring-orange-500 outline-none text-sm font-medium">
            </div>
            <div id="order-notice" class="text-[11px] p-3 rounded-xl"></div>
            
            <div class="space-y-2 py-2">
                <div class="flex justify-between text-sm text-slate-500">
                    <span>Subtotal</span>
                    <span id="subtotal">0 K</span>
                </div>
                <div class="flex justify-between text-lg font-extrabold text-slate-800">
                    <span>Total</span>
                    <span id="final-total" class="text-orange-600">0 K</span>
                </div>
            </div>

            <button id="order-btn" onclick="submitOrder()" class="w-full py-5 bg-slate-900 text-white rounded-[20px] font-extrabold text-lg shadow-xl shadow-slate-200 active:scale-95 transition">
                Confirm Order
            </button>
        </div>
    </div>

    <script>
        const _supabase = supabase.createClient("https://iogpnvljnhsxuzzdltpb.supabase.co", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlvZ3BudmxqbmhzeHV6emRsdHBiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY3NTk2MDYsImV4cCI6MjA4MjMzNTYwNn0.Kxy3QW1gq-J-tzUF2fxQd0l989Wr7BI2uRTbWDTNL6k");

        let cart = {};
        const menuData = [
            { id: 1, name: 'ကြက်ပေါင်ကင်', price: 4000, category: 'Chicken', image: 'https://images.unsplash.com/photo-1598103442097-8b74394b95c6?w=400' },
            { id: 2, name: 'ဆိတ်သားကင်', price: 1500, category: 'Chicken', image: 'https://i.ibb.co/twQjTScV/IMG-20251231-003231.png' },
            { id: 3, name: 'ငုံးဥ', price: 1000, category: 'Sides', image: 'https://images.unsplash.com/photo-1569350080881-229202377313?w=400' }
        ];

        // --- Operating Hours Logic ---
        function checkShopStatus() {
            const now = new Date();
            const hour = now.getHours();
            const isOpen = hour >= 17 && hour < 21; // 5pm to 9pm
            
            const statusUI = document.getElementById('shop-status-ui');
            const noticeUI = document.getElementById('order-notice');
            const orderBtn = document.getElementById('order-btn');

            if (isOpen) {
                statusUI.innerHTML = `<span class="flex items-center text-[10px] text-green-500 font-bold"><span class="w-2 h-2 bg-green-500 rounded-full mr-1 animate-pulse"></span> Open Now (Until 9 PM)</span>`;
                noticeUI.innerHTML = `<p class="text-green-600 bg-green-50 p-2 rounded-lg">✅ ယခုမှာယူပါက ချက်ချင်း ပို့ဆောင်ပေးပါမည်။</p>`;
                orderBtn.disabled = false;
                orderBtn.style.opacity = "1";
            } else {
                statusUI.innerHTML = `<span class="badge-closed text-[10px]">Closed (Opens at 5 PM)</span>`;
                noticeUI.innerHTML = `<p class="text-orange-600 bg-orange-50 p-2 rounded-lg">⏳ ယခုမှာယူထားသော Order ကို ညနေ ၅ နာရီမှစတင်၍ ပို့ဆောင်ပေးပါမည်။</p>`;
                // ဆိုင်ပိတ်ထားသော်လည်း အော်ဒါကြိုတင် လက်ခံလိုပါက disabled မလုပ်ပါနှင့်
                orderBtn.disabled = false; 
            }
            return isOpen;
        }

        function renderMenu() {
            document.getElementById('menu-grid').innerHTML = menuData.map(i => `
                <div class="product-card bg-white rounded-[2rem] shadow-sm border border-slate-50 overflow-hidden p-2">
                    <img src="${i.image}" class="w-full h-36 object-cover rounded-[1.5rem]">
                    <div class="p-3 text-center">
                        <h3 class="font-bold text-sm text-slate-800">${i.name}</h3>
                        <p class="text-orange-600 font-extrabold mt-1 text-md">${i.price.toLocaleString()} K</p>
                        <button onclick="addToCart(${i.id})" class="mt-2 w-full py-2.5 bg-slate-900 text-white rounded-xl text-xs font-bold active:scale-95 transition">Add</button>
                    </div>
                </div>
            `).join('');
        }

        function addToCart(id) {
            const item = menuData.find(m => m.id === id);
            if(cart[id]) cart[id].qty++;
            else cart[id] = { ...item, qty: 1 };
            updateUI();
        }

        function updateQty(id, delta) {
            cart[id].qty += delta;
            if(cart[id].qty <= 0) delete cart[id];
            updateUI();
        }

        function updateUI() {
            const items = Object.values(cart);
            const subtotal = items.reduce((sum, i) => sum + (i.price * i.qty), 0);
            
            document.getElementById('cart-count').innerText = items.reduce((s,i) => s + i.qty, 0);
            document.getElementById('subtotal').innerText = subtotal.toLocaleString() + " K";
            document.getElementById('final-total').innerText = subtotal.toLocaleString() + " K";

            document.getElementById('cart-items').innerHTML = items.map(i => `
                <div class="flex items-center gap-4 animate-in slide-in-from-right duration-300">
                    <img src="${i.image}" class="w-20 h-20 rounded-2xl object-cover shadow-md">
                    <div class="flex-1">
                        <h4 class="font-extrabold text-slate-800">${i.name}</h4>
                        <p class="text-xs text-orange-500 font-bold">${i.price.toLocaleString()} K</p>
                        <div class="flex items-center gap-3 mt-2 bg-slate-100 w-fit p-1 rounded-xl">
                            <button onclick="updateQty(${i.id}, -1)" class="w-8 h-8 flex items-center justify-center font-bold text-slate-500">-</button>
                            <span class="text-sm font-bold w-4 text-center">${i.qty}</span>
                            <button onclick="updateQty(${i.id}, 1)" class="w-8 h-8 flex items-center justify-center font-bold text-orange-600">+</button>
                        </div>
                    </div>
                    <button onclick="delete cart[${i.id}]; updateUI();" class="text-slate-300 hover:text-red-500"><i class="fas fa-trash-alt"></i></button>
                </div>
            `).join('');
        }

        async function submitOrder() {
            const name = document.getElementById('cust-name').value;
            const phone = document.getElementById('cust-phone').value;
            
            if(!name || !phone || Object.keys(cart).length === 0) {
                return alert("အချက်အလက်များကို ပြည့်စုံစွာ ဖြည့်ပေးပါ ခင်ဗျာ။");
            }

            const btn = document.getElementById('order-btn');
            const originalText = btn.innerText;
            btn.disabled = true;
            btn.innerText = "Processing...";

            const isOpen = checkShopStatus();

            const orderData = {
                customer_name: name,
                customer_phone: phone,
                items: Object.values(cart),
                total_amount: document.getElementById('final-total').innerText,
                order_type: isOpen ? 'Instant' : 'Pre-order',
                status: 'Pending'
            };

            try {
                const { error } = await _supabase.from('orders').insert([orderData]);
                if(error) throw error;

                // Success Animation
                alert("လူကြီးမင်း၏ အော်ဒါ တင်ပြီးပါပြီ။ ကျေးဇူးတင်ပါသည်!");
                
                // Clear Cart
                cart = {}; updateUI(); toggleCart(false);
                
                // Save profile for next time
                localStorage.setItem('mt_user', JSON.stringify({name, phone}));

            } catch (err) {
                alert("အမှားအယွင်းတစ်ခု ဖြစ်ပွားခဲ့ပါသည်။ နောက်မှ ပြန်ကြိုးစားပါ။");
                console.error(err);
            } finally {
                btn.disabled = false;
                btn.innerText = originalText;
            }
        }

        function toggleCart(s) { document.getElementById('cart-drawer').classList.toggle('active', s); }

        // Start
        renderMenu();
        checkShopStatus();
        setInterval(checkShopStatus, 60000); // Check status every minute

        // Load profile if exists
        const saved = JSON.parse(localStorage.getItem('mt_user'));
        if(saved) {
            document.getElementById('cust-name').value = saved.name;
            document.getElementById('cust-phone').value = saved.phone;
        }
    </script>
</body>
</html>
